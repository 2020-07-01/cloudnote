<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset='utf-8'>
    <title>cloudNote</title>
    <script src="../static/layui-v2.5.5/layui/layui.js"></script>
    <script src="../static/layui-v2.5.5/layui/admin.js"></script>
    <link rel='stylesheet' media='screen' href="../static/layui-v2.5.5/layui/css/layui.css" type='text/css'>
    <!--引入jquery-->
    <script src="../static/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../static/common.js"></script>
    <style>

        .layui-body {
            left: 0px;
        }

        .layui-footer1 {
            position: fixed;
            left: 0px;
            right: 0;
            bottom: 0;
            height: 44px;
            line-height: 44px;
            padding: 0 15px;
            background-color: #eee
        }

        .layuiadmin-card-list p.layuiadmin-big-font {
            font-size: 36px;
            color: #666;
            line-height: 36px;
            padding: 5px 0 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            white-space: nowrap
        }

        .layuiadmin-badge {
            top: 50%;
            margin-top: -9px;
            color: #01AAED
        }

        .layuiadmin-badge, .layuiadmin-btn-group, .layuiadmin-span-color {
            position: absolute;
            right: 15px
        }

        .layadmin-carousel {
            height: 185px !important;
            background-color: #fff
        }
        .layadmin-backlog .layadmin-backlog-body {
            display: block;
            padding: 10px 15px;
            background-color: #f8f8f8;
            color: #999;
            border-radius: 2px;
            transition: all .3s;
            -webkit-transition: all .3s
        }


        .layadmin-backlog .layadmin-backlog-body {
            display: block;
            padding: 10px 15px;
            background-color: #f8f8f8;
            color: #999;
            border-radius: 2px;
            transition: all .3s;
            -webkit-transition: all .3s
        }

        .layadmin-backlog-body h3 {
            padding-bottom: 10px;
            font-size: 12px
        }
    </style>
</head>

<body>
<!--顶部导航栏-->
<div class="layui-layout layui-layout-admin">

    <div class="layui-header">
        <div><a href="javascript:location.reload();" class="layui-logo">云笔记平台</a></div>

        <ul class="layui-nav layui-layout-right">

            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    <span id="headAccountName">admin</span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="#" id="logout"><i class="layui-icon layui-icon-prev"></i> 注销登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <div class="layui-body">
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-sm6 layui-col-md3">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            用户总数
                            <span class="layui-badge layui-bg-green layuiadmin-badge">ALL</span>
                        </div>
                        <div class="layui-card-body layuiadmin-card-list">
                            <p class="layuiadmin-big-font" id="accountCount"></p>
                            <p>
                                活跃用户
                                <span id="aliveAccountCount" class="layuiadmin-span-color"><i
                                        class="layui-inline layui-icon layui-icon-user"></i></span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm6 layui-col-md3">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            笔记总数
                            <span class="layui-badge layui-bg-blue layuiadmin-badge">ALL</span>
                        </div>
                        <div class="layui-card-body layuiadmin-card-list">
                            <p id="noteCount" class="layuiadmin-big-font"></p>
                            <p>
                                今日新创建
                                <span  id="currentDayNoteCount" class="layuiadmin-span-color"><i
                                        class="layui-inline layui-icon layui-icon-face-smile-b"></i></span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="layui-col-sm6 layui-col-md3">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            图片总数
                            <span class="layui-badge layui-bg-cyan layuiadmin-badge">ALL</span>
                        </div>
                        <div class="layui-card-body layuiadmin-card-list">
                            <p id="imageCount" class="layuiadmin-big-font"></p>
                            <p>
                                今日新创建
                                <span id="currentDayImageCount" class="layuiadmin-span-color"><i
                                        class="layui-inline layui-icon layui-icon-face-smile-b"></i></span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm6 layui-col-md3">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            文档总数
                            <span class="layui-badge layui-bg-orange layuiadmin-badge">ALL</span>
                        </div>
                        <div class="layui-card-body layuiadmin-card-list">

                            <p id="fileCount" class="layuiadmin-big-font"></p>
                            <p>
                                今日新创建
                                <span id="currentDayFileCount" class="layuiadmin-span-color"><i class="layui-inline layui-icon layui-icon-user"></i></span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm12 layui-col-md12">
                    <div class="layui-row layui-col-space15">
                        <div class="layui-card">
                            <div class="layui-card-header">用户信息列表</div>
                            <div class="layui-card-body">
                                <table id="accountList" class="layui-table layuiadmin-page-table" lay-skin="line"
                                       lay-filter="accountList"></table>
                            </div>
                        </div>
                    </div>
                </div>

        <!--        <div class="layui-row layui-col-space15">
                    <div class="layui-card">
                        <div class="layui-card-header">邮件服务</div>
                        <div class="layui-card-body">

                            <div class="layui-col-sm6">
                                <div class="layui-card">
                                    <div class="layui-card-header">邮件内容</div>
                                    <div class="layui-card-body">


                                    </div>
                                </div>
                            </div>

                            <div class="layui-col-sm6">
                                <div class="layui-card">
                                    <div class="layui-card-header">选择用户</div>
                                    <div class="layui-card-body">
                                        <div class="layui-tab-content">
                                            <div class="layui-tab-item layui-show">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>-->

                <!-- <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">详细数据</div>
                        <div class="layui-card-body">
                            <div class="layadmin-carousel layadmin-backlog">
                                <div carousel-item>
                                    <ul class="layui-row layui-col-space10">
                                        <li class="layui-col-xs6">
                                            <a class="layadmin-backlog-body">
                                                <h3>待审评论</h3>
                                                <p layuiadmin-big-font></p>66</cite></p>
                                            </a>
                                        </li>
                                        <li class="layui-col-xs6">
                                            <a class="layadmin-backlog-body">
                                                <h3>待审帖子</h3>
                                                <p layuiadmin-big-font></p>66</cite></p>
                                            </a>
                                        </li>
                                        <li class="layui-col-xs6">
                                            <a  class="layadmin-backlog-body">
                                                <h3>待审商品</h3>
                                                <p layuiadmin-big-font></p>66</cite></p>
                                            </a>
                                        </li>
                                        <li class="layui-col-xs6">
                                            <a class="layadmin-backlog-body">
                                                <h3>待发货</h3>
                                                <p layuiadmin-big-font></p>66</cite></p>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>-->

              <!--  <div class="layui-col-sm12">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            访问量
                            <div class="layui-btn-group layuiadmin-btn-group">
                                <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs">去年</a>
                                <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs">今年</a>
                            </div>
                        </div>
                        <div class="layui-card-body">
                            <div class="layui-row">


                                <div class="layui-col-sm4">
                                    <input id="input-search-note" type="text" placeholder="搜索" autocomplete="off"
                                           class="layui-input" maxlength="12"
                                           style="border-right: none;boder-top:none;border-bottom: none;font-size: 16px"/>

                                </div>

                                <div class="layui-col-sm8">
                                    <div class="layuiadmin-card-list">
                                        <p class="layuiadmin-normal-font">月访问数</p>
                                        <span>同上期增长</span>
                                        <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                            <div class="layui-progress-bar" lay-percent="30%"></div>
                                        </div>
                                    </div>
                                    <div class="layuiadmin-card-list">
                                        <p class="layuiadmin-normal-font">月下载数</p>
                                        <span>同上期增长</span>
                                        <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                            <div class="layui-progress-bar" lay-percent="20%"></div>
                                        </div>
                                    </div>
                                    <div class="layuiadmin-card-list">
                                        <p class="layuiadmin-normal-font">月收入</p>
                                        <span>同上期增长</span>
                                        <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                            <div class="layui-progress-bar" lay-percent="25%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
    </div>

    <div class="layui-footer1 layui-bg-black">
        © layui.com - 底部固定区域
    </div>
</div>


</div>
</body>

<script type="text/html" id="operate">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="lock">锁定</a>
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="unLock">解锁</a>
    <a class="layui-btn layui-btn-xs" lay-event="showDetail">详情</a>
</script>

<script th:inline="none">

    //设置全局token
    var token = sessionStorage.getItem("token");

    layui.use(['table', 'element', 'form', 'layer'], function () {
        var table = layui.table;


        init_accountList();
        initHeadData();

        //初始化账户列表
        function init_accountList(){
            table.render({
                elem: '#accountList'
                , where: {token: token}//传递token到服务端
                , url: '/admin/account_list.json' //默认传递两个参
                , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                , loading: true
                , text: ''
                , cols: [[
                    {type: 'checkbox', fixed: 'left'}
                    , {field: 'accountId', title: 'ID', align: 'center', width: 50, fixed: 'left', unresize: true}
                    , {field: 'accountName', title: '用户名', align: 'center', width: 140, unresize: false,fixed: 'left'}
                    , {field: 'sex', title: '性别', width: 60, align: 'center', unresize: true}
                    , {field: 'birthday', title: '出生日期', align: 'center', width: 105, unresize: true}
                    , {field: 'area', title: '区域', align: 'center', width: 120, unresize: false}
                    , {field: 'email', title: '邮箱', align: 'center', width: 170, unresize: false}
                    , {field: 'phone', title: '手机', align: 'center', width: 120, unresize: true}
                    , {field: 'level', title: '等级', align: 'center', width: 100, unresize: false}
                    , {field: 'isOnline', title: '是否在线', align: 'center', width: 90, unresize: true}
                    , {field: 'isLocked', title: '是否锁定', align: 'center', width: 90, unresize: true}
                    , {fixed: 'right', title: '操作', align: 'center', toolbar: '#operate', width: 160}
                ]]
                , page: true
            });
        }
        //监听操作
        table.on('tool(accountList)', function (obj) {
            if (obj.event === 'showDetail') {
                showDetail(obj.data);

            } else if (obj.event === 'unLock') {
                if (obj.data.isLocked == "UNLOCK"){
                    layer.msg("不支持该操作!");
                }else {
                    layer.confirm('确定要解锁吗？', function (index) {
                        lock(obj.data,'UNLOCK');
                        layer.close(index);
                    });
                }

            } else if (obj.event === 'lock') {
                if (obj.data.isLocked == "LOCK") {
                    layer.msg("不支持该操作!");
                } else {
                    layer.confirm('确定要锁定该用户吗？', function (index) {
                        lock(obj.data, 'LOCK');
                        layer.close(index);
                    });
                }
            }
        });

        //锁定/解锁用户
        function lock(data,flag) {
            var jsonData = JSON.stringify(data);
            $.ajax({
                type: "post",
                contentType: "application/json",
                data: jsonData,
                headers: {'Content-Type': 'application/json;charset=utf8', 'token': token,'isLock':flag},
                url: "/admin/lock_unlock.json",
                success: function (result) {
                    if (result.code == 1) {
                        layer.msg(result.message);
                        init_accountList();
                    } else {
                        layer.msg(result.message);
                    }
                },
                error: function () {
                    alert("网络出现异常!");
                }
            });
        }



        //查看详细信息
        function showDetail(data) {

        }

        //获取头部概况数据
        function initHeadData(){
            $.ajax({
                type: "post",
                contentType: "application/json",
                headers: {'Content-Type': 'application/json;charset=utf8', 'token': token},
                url: "/admin/get_head_data.json",
                success: function (result) {
                    if (result.code == 1) {
                        setHeadData(result.data);
                    } else {
                        layer.msg(result.message);
                    }
                },
                error: function () {
                    alert("网络出现异常!");
                }
            });
        };

        //头部数据赋值
        function setHeadData(obj){
            $('#accountCount').text(obj.accountCount);
            $('#aliveAccountCount').html(obj.aliveAccountCount);
            $('#noteCount').text(obj.noteCount);
            $('#currentDayNoteCount').html(obj.currentDayNoteCount);
            $('#imageCount').text(obj.imageCount);
            $('#currentDayImageCount').html(obj.currentDayImageCount);
            $('#fileCount').text(obj.fileCount);
            $('#currentDayFileCount').html(obj.currentDayFileCount);
        }

        $("#logout").click(function () {
            logout(token);
        })
    });
</script>

</html>