<!DOCTYPE html>
<html>
<head>

    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>note</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <!--引入layui-->
    <link rel='stylesheet' type='text/css' media='screen' href='../static/layui-v2.5.5/layui/css/layui.css'>
    <script src="../static/layui-v2.5.5/layui/layui.js"></script>
    <!--引入jquery-->
    <script src="../static/jquery-3.4.1.min.js"></script>

    <style>

    </style>
</head>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!--头部导航栏-->
    <div class="layui-header">
        <div><a class="layui-logo" id="cloudNote" href="/to_index">云笔记平台</a></div>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    admin
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="information">账号设置</a></dd>
                    <dd><a href="">意见反馈</a></dd>
                    <dd><a href="">注销登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>
    <!--左侧导航栏-->
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" lay-filter="select-type">
                <li class="layui-nav-item">
                    <a>我的笔记</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/to_note_page">查看</a></dd>
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-nav-tree">
                <li class="layui-nav-item">
                    <a href="javascript:;">我的资源</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/to_image_page">图片</a></dd>
                        <dd><a href="javascript:;">视频</a></dd>
                        <dd><a href="javascript:;">文档</a></dd>
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-nav-tree">
                <li class="layui-nav-item">
                    <a href="javascript:;">我的日程</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/to_schedule_page">查看</a>
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-nav-tree">
                <li class="layui-nav-item">
                    <a href="javascript:;">回收站</a>
                    <dl class="layui-nav-child" style="text-align: left">
                        <dd><a href="javascript:;">全部恢复</a></dd>
                        <dd><a href="javascript:;">全部清空</a></dd>
                        <dd><a href="javascript:;">查看全部</a></dd>
                    </dl>
                </li>
            </ul>

        </div>
    </div>
    <!--中间部分-->
    <div class="layui-body">
        <div class="layui-tab" lay-filter="tab" style="margin: 10px auto;text-align: center">
            <ul class="layui-tab-title">
                <li class="layui-this" lay-id="11">账号信息</li>
                <li lay-id="44">用户信息</li>
                <li lay-id="33">修改密码</li>
                <!-- <li lay-id="55">其他</li>-->
            </ul>
            <hr class="layui-bg-black" style="">
            <div class="layui-tab-content">
                <!--账号信息-->
                <div class="layui-tab-item layui-show">
                    <div class="layui-row">
                        <div class="layui-col-xs3">
                            <div class="grid-demo grid-demo-bg1">&nbsp;</div>
                        </div>
                        <div class="layui-col-xs9">
                            <div class="grid-demo grid-demo-bg1">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">账号：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="userName" id="userName" value="xianxin" readonly
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">注册日期：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="phone" id="registerdate" value="" lay-verify="phone"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">手机号：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="phone" id="phone" value="" lay-verify="phone"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                    <!--弹窗验证--->
                                    <div>修改</div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">邮箱：</label>
                                    <div class="layui-input-inline">
                                        <input type="email" name="email" id="email" lay-verify="email"
                                               autocomplete="off"
                                               class="layui-input">
                                    </div>
                                    <!--弹窗验证--->
                                    <div>修改</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--用户信息-->
                <div class="layui-tab-item">
                    <div class="layui-row">
                        <div class="layui-col-xs2">
                            <div class="grid-demo grid-demo-bg1">
                                &nbsp;
                            </div>
                        </div>
                        <div class="layui-col-xs10">
                            <div class="grid-demo grid-demo-bg1">
                                <form class="layui-form" action="post">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">头像</label>
                                        <div class="layui-input-inline">
                                            <input name="headImageUrl" id="headImageUrl" lay-verify="required"
                                                   placeholder="图片地址"
                                                   value="http://cdn.layui.com/avatar/168.jpg" class="layui-input">
                                        </div>
                                        <div class="layui-input-inline layui-btn-container" style="width: auto;">
                                            <button type="button" class="layui-btn layui-btn-primary"
                                                    id="LAY_avatarUpload">
                                                <i class="layui-icon">&#xe67c;</i>上传图片
                                            </button>
                                            <button class="layui-btn layui-btn-primary" layadmin-event="avartatPreview">
                                                预览图片
                                            </button>
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">性别</label>
                                        <div class="layui-input-block">
                                            <input type="radio" id="man" name="sex" value="男" title="男"
                                                   lay-filter="man"/>
                                            <input type="radio" id="woman" name="sex" value="女" title="女"
                                                   lay-filter="woman"/>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <label class="layui-form-label">地区</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="province" id="province" placeholder="请输入省"
                                                   class="layui-input">
                                        </div>
                                        <div class="layui-input-inline">
                                            <input type="text" name="city" id="city" placeholder="请输入市"
                                                   class="layui-input">
                                        </div>
                                    </div>

                                    <div class="layui-form-item layui-form-text">
                                        <label class="layui-form-label">备注</label>
                                        <div class="layui-input-block">
                                <textarea name="remark" id="remark" placeholder="请输入内容" class="layui-text"
                                          style="height: 50px; width:480px;resize: none;"></textarea>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="button" lay-submit class="layui-btn"
                                                    lay-filter="userInformation">确认修改
                                            </button>
                                            <button type="reset" class="layui-btn layui-btn-primary">重新填写</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--修改密码-->
                <div class="layui-tab-item">
                    <div class="layui-row">
                        <div class="layui-col-xs3">
                            <div class="grid-demo grid-demo-bg1">
                                &nbsp;
                            </div>
                        </div>
                        <div class="layui-col-xs9">
                            <div class="grid-demo grid-demo-bg1">

                                <div class="layui-form-item">
                                    <label class="layui-form-label">当前密码</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="currentPassword" id="currentPassword"
                                               readonly
                                               class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">新密码</label>
                                    <div class="layui-input-inline">
                                        <input type="password" id="accountPassword" name="accountPassword"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">确认新密码</label>
                                    <div class="layui-input-inline">
                                        <input type="password" id="confirmPassword" name="confirmPassword"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button type="button" class="layui-btn" id="editPassword">确认修改</button>
                                        <button type="button" class="layui-btn" id="reset2">重置</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">其他</div>
            </div>
        </div>
    </div>
    <!-- 底部固定区域 -->
    <div class="layui-footer layui-bg-black">
        © layui.com - 底部固定区域
    </div>
</div>
</body>

<!--加载所需要的基础模块-->
<script>

    //设置全局token
    var token = sessionStorage.getItem("token");

    //设置性别
    var sexValue = "";

    layui.use(['element', 'form'], function () {
        var element = layui.element;
        var form = layui.form;

        //Hash地址的定位
        var layid = location.hash.replace(/^#tab=/, '');
        element.tabChange('tab', layid);
        //监听选项卡的切换
        element.on('tab(tab)', function (data) {
            //如果为修改密码，获取当前用户的密码并进行显示
            if (data.index == 2) {
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    dataType: 'json',
                    headers: {'Content-Type': 'application/json;charset=utf8', 'token': token},
                    url: "http://localhost:8080/account/showPassword.json",
                    success: function (result) {
                        if (result.code == 1) {
                            var temp = result.message;
                            $('#currentPassword').val(temp);
                        } else {
                            layer.msg('查询出现错误!');
                        }
                    },
                })
            }
            location.hash = 'tab=' + $(this).attr('lay-id');
        });

        $("#editPassword").click(function () {
            var accountPassword = $('#accountPassword').val();
            var confirmPassword = $('#confirmPassword').val();
            var formData = {
                "accountPassword": accountPassword,
                "confirmPassword": confirmPassword
            }
            var jsonData = JSON.stringify(formData);
            $.ajax({
                type: "post",
                contentType: "application/json",
                dataType: 'json',
                data: jsonData,
                headers: {'Content-Type': 'application/json;charset=utf8', 'token': token},
                url: "http://localhost:8080/account/updatePassword.json",
                success: function (result) {
                    if (result.code == 1) {
                        $('#currentPassword').val(accountPassword);
                        layer.msg(result.message);
                    } else {
                        layer.msg(result.message);
                    }
                },
            })
        });

        //重置2
        $("#reset2").click(function () {
            $('#accountPassword').val("");
            $('#confirmPassword').val("");
        })

        //账号信息
        form.on('submit(userInformation)', function (data) {
            alert(JSON.stringify(data));
            var field = JSON.stringify(data.field);
            var formData = {
                "sex": sexValue,
                "field": field
            }
            var jsonData = JSON.stringify(formData);
            $.ajax({
                type: "post",
                contentType: "application/json",
                dataType: 'json',
                data: jsonData,
                headers: {'Content-Type': 'application/json;charset=utf8', 'token': token},
                url: "http://localhost:8080/PIM/updatePIM.json",
                success: function (result) {
                    if (result.code == 1) {
                        layer.msg(result.message);
                    } else {
                        layer.msg(result.message);
                    }
                },
            })
        });

        //监听性别选择
        form.on('radio(man)', function (data) {
            sexValue = data.value;
        });

        //监听性别选择
        form.on('radio(woman)', function (data) {
            sexValue = data.value;
        });

    });

</script>


</html>